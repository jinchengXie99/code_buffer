C51 COMPILER V9.60.7.0   USERDRYER                                                         04/03/2024 13:19:55 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE USERDRYER
OBJECT MODULE PLACED IN .\Output\UserDryer.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\User\Source\UserFiles\UserDryer.c LARGE OMF2 WARNINGLEVEL(0) OPTIMIZE
                    -(5,SPEED) BROWSE INCDIR(..\Library\FU68xx_Hardware_Driver\Include;..\User\Include) DEBUG PRINT(.\Listing\UserDryer.lst) 
                    -TABS(2) OBJECT(.\Output\UserDryer.obj)

line level    source

   1          
   2          
   3          /* Includes -------------------------------------------------------------------------------------*/
   4          #include <FU68xx_2.h>
   5          #include <Myproject.h>
   6          #include <Customer_Debug.h>
   7          
   8          #include <UserGlobal.h>
   9          #include <UserDefine.h>
  10          
  11          /* Private typedef ------------------------------------------------------------------------------*/
  12          /* Private define -------------------------------------------------------------------------------*/
  13          /* Private macro --------------------------------------------------------------------------------*/
  14          /* Private variables ----------------------------------------------------------------------------*/
  15          /* Private function prototypes ------------------------------------------------------------------*/
  16          /* Private functions ----------------------------------------------------------------------------*/
  17          
  18          //============================================================================//
  19          
  20          //// ·½°å
  21          //#define KEY_ON                GP06          // ¿ªÆô¶Ë
  22          //#define KEY_LOCK              GP05          // Ëø¶¨¶Ë
  23          
  24          //#define KEY_SPEED             GP17          // ËÙ¶È°´¼ü
  25          //#define KEY_HEAT              GP15          // ÈÈ¶È°´¼ü
  26          //#define KEY_COOL              GP13          // Àä·ç°´¼ü
  27          
  28          //#define LED_SPEED_1           GP03          // ·çËÙµÆ
  29          //#define LED_SPEED_2           GP02
  30          //#define LED_SPEED_3           GP01
  31          
  32          //#define LED_HEAT_1            GP00          // ÈÈÁ¿µÆ
  33          //#define LED_HEAT_2            GP37
  34          //#define LED_HEAT_3            GP36
  35          
  36          // Ô²°å
  37          #define KEY_ON                GP06          // ¿ªÆô¶Ë
  38          #define KEY_LOCK              GP05          // Ëø¶¨¶Ë
  39          
  40          #define KEY_SPEED             GP15          // ËÙ¶È°´¼ü
  41          #define KEY_HEAT              GP13          // ÈÈ¶È°´¼ü
  42          #define KEY_COOL              GP17          // Àä·ç°´¼ü
  43          
  44          #define LED_SPEED_1           GP00          // ·çËÙµÆ
  45          #define LED_SPEED_2           GP37
  46          #define LED_SPEED_3           GP36
  47          
  48          #define LED_HEAT_1            GP03          // ÈÈÁ¿µÆ
  49          #define LED_HEAT_2            GP02
  50          #define LED_HEAT_3            GP01
  51          
  52          
  53          // xjc µµÎ»¶þ½øÖÆ
C51 COMPILER V9.60.7.0   USERDRYER                                                         04/03/2024 13:19:55 PAGE 2   

  54          #define   LED_SPEED_bit_1   GP03
  55          #define   LED_SPEED_bit_2   GP02
  56          #define   LED_SPEED_bit_3   GP01
  57          #define   LED_SPEED_bit_4   GP00
  58          #define   LED_SPEED_bit_5   GP37
  59          #define   LED_SPEED_bit_6   GP36
  60          
  61          #define HEAT_WIRE_H_ON        0//(GP11=0)          // ¸ßÈÈ¼ÓÈÈË¿Ê¹ÄÜ
  62          #define HEAT_WIRE_L_ON        0//(GP10=0)          // µÍÈÈ¼ÓÈÈË¿Ê¹ÄÜ
  63          #define HEAT_WIRE_H_OFF       1//(GP11=1)          // ¸ßÈÈ¼ÓÈÈË¿Ê¹ÄÜ
  64          #define HEAT_WIRE_L_OFF       1//(GP10=1)          // µÍÈÈ¼ÓÈÈË¿Ê¹ÄÜ
  65          
  66          #define LED_SET_ON            0             // LEDÓÐÐ§ÁÁ
  67          #define LED_SET_OFF           1             // LEDÎÞÐ§Ãð
  68          
  69          #define SPD_CMD_LV_MAX        11            // ×ªËÙ×î¸ßµ²
  70          #define HEAT_CMD_LV_MAX       4             // ÎÂ¶È×î¸ßµ²
  71          
  72          #define START_SPD_CMD_LV      1             // Æô¶¯×ªËÙµ²ÉèÖÃ  1 2 3
  73          #define START_HEAT_CMD_LV     1             // Æô¶¯ÎÂ¶Èµ²ÉèÖÃ  0 1 2 3 4
  74          #define START_COOL_CMD_LV     0             // Æô¶¯Àä·çµ²ÉèÖÃ
  75          
  76          #define POWER_LV1             70            // 1µ²¹¦ÂÊ - W
  77          #define POWER_LV2             80            // 2µ²¹¦ÂÊ - W
  78          #define POWER_LV3             90            // 3µ²¹¦ÂÊ - W
  79          
  80          #define RPM_LV1               111000        // 1µ²×ªËÙ - RPM
  81          #define RPM_LV2               121000        // 2µ²×ªËÙ - RPM
  82          #define RPM_LV3               131000        // 3µ²×ªËÙ - RPM
  83          
  84          #define HEAT_DUTY_LV1         9              // 1µ²Õ¼¿Õ±È×î´óÖµ - n/5
  85          #define HEAT_DUTY_LV2         13             // 2µ²Õ¼¿Õ±È×î´óÖµ - n/5
  86          #define HEAT_DUTY_LV3         18             // 3µ²Õ¼¿Õ±È×î´óÖµ - n/5
  87          #define HEAT_DUTY_LV4         18             // 3µ²Õ¼¿Õ±È×î´óÖµ - n/5
  88          #define HEAT_DUTY_LV4_1       13             // 3µ²ÎÂ¶È1µµ·çËÙÕ¼¿Õ±È×î´óÖµ - n/5
  89          
  90          #define HEAT_TEMPER_LV1       100             // 1µ²¸ø¶¨ÈÈ·çÎÂ¶È - ÉãÊÏ¶È
  91          #define HEAT_TEMPER_LV2       100             // 2µ²¸ø¶¨ÈÈ·çÎÂ¶È - ÉãÊÏ¶È
  92          #define HEAT_TEMPER_LV3       100             // 3µ²¸ø¶¨ÈÈ·çÎÂ¶È - ÉãÊÏ¶È
  93          #define HEAT_TEMPER_LV4       100             // 4µ²¸ø¶¨ÈÈ·çÎÂ¶È - ÉãÊÏ¶È
  94          
  95          #define HEAT_R_VAL_LV1        29.8255       // 1µ²¸ø¶¨ÈÈ·çÎÂ¶È¶ÔÓ¦²ÉÑùµç×èÖµ
  96          #define HEAT_R_VAL_LV2        24.816        // 2µ²¸ø¶¨ÈÈ·çÎÂ¶È¶ÔÓ¦²ÉÑùµç×èÖµ
  97          #define HEAT_R_VAL_LV3        17.4087       // 3µ²¸ø¶¨ÈÈ·çÎÂ¶È¶ÔÓ¦²ÉÑùµç×èÖµ
  98          #define HEAT_R_VAL_LV4        17.4087       // 4µ²¸ø¶¨ÈÈ·çÎÂ¶È - ÉãÊÏ¶È
  99          
 100          #define THRYRST_ENABLE        1             //  0:½ûÖ¹ 1:Ê¹ÄÜ  ÊÇ·ñ¿ØÖÆ¾§Õ¢¹Ü
 101          #define CHECK_HEATER_TEMPER   1             //  0:½ûÖ¹ 1:Ê¹ÄÜ  ÊÇ·ñ¼ì²âµçÈÈË¿ÎÂ¶ÈÊÇ·ñ
 102          
 103          #define SPEED_LV1             _Q15(RPM_LV1 / MOTOR_SPEED_BASE)
 104          #define SPEED_LV2             _Q15(RPM_LV2 / MOTOR_SPEED_BASE)
 105          #define SPEED_LV3             _Q15(RPM_LV3 / MOTOR_SPEED_BASE)
 106          #define SPEED_LV_ADD          _Q15(1000/ MOTOR_SPEED_BASE)       // xjc¼ÓÒ»¸öµ²Î» ËÙ¶È¼Ó1000
 107          
 108          #define HEAT_ADC_VAL_LV1      HEAT_CELSIUS_ADC(HEAT_R_VAL_LV1)    // 1µ²¸ø¶¨ÈÈ·çÎÂ¶È¶ÔÓ¦²ÉÑùµç×èÖµ
 109          #define HEAT_ADC_VAL_LV2      HEAT_CELSIUS_ADC(HEAT_R_VAL_LV2)    // 2µ²¸ø¶¨ÈÈ·çÎÂ¶È¶ÔÓ¦²ÉÑùµç×èÖµ
 110          #define HEAT_ADC_VAL_LV3      HEAT_CELSIUS_ADC(HEAT_R_VAL_LV3)    // 3µ²¸ø¶¨ÈÈ·çÎÂ¶È¶ÔÓ¦²ÉÑùµç×èÖµ
 111          #define HEAT_ADC_VAL_LV4      HEAT_CELSIUS_ADC(HEAT_R_VAL_LV4)    // 3µ²¸ø¶¨ÈÈ·çÎÂ¶È¶ÔÓ¦²ÉÑùµç×èÖµ
 112          
 113          #define POWER_DUTY_LV1        CAL_POWER_Q12(POWER_LV1)
 114          #define POWER_DUTY_LV2        CAL_POWER_Q12(POWER_LV2)
 115          #define POWER_DUTY_LV3        CAL_POWER_Q12(POWER_LV3)
C51 COMPILER V9.60.7.0   USERDRYER                                                         04/03/2024 13:19:55 PAGE 3   

 116          
 117          #define POWER_UXI_SMP_LV1     (u32)POWER_TO_SMP(POWER_LV1)//*0.9
 118          #define POWER_UXI_SMP_LV2     (u32)POWER_TO_SMP(POWER_LV2)//*0.93
 119          #define POWER_UXI_SMP_LV3     (u32)POWER_TO_SMP(POWER_LV3)//*0.95
 120          
 121          //============================================================================//
 122          
 123          extern u16 PwrOnX1ms;
 124          extern u8  Loop1msCnt;
 125          extern u8  QuickStartFlag;
 126          extern u16 UBusX10;
 127          extern u16 RunningX1ms;
 128          extern u16 IBusFilt_mA;
 129          extern u16 IBusCommand_mA;
 130          extern u16 IBusSmp;
 131          extern u8  KeyOnOffCmd;
 132          extern u8  KeyOnOffTrig;
 133          extern u16 KeyGoDuty;
 134          extern u16 KeyGoDutyMax;
 135          extern u32 idata UxISmp;
 136          extern u32 idata VspPwrCmd;
 137          extern s16 idata VspSpdAlt;
 138          extern s16 idata VspSpdCmd;
 139          extern s16 idata VspSpdCmdMax;
 140          extern u8  idata AlarmFlag;                // ±¨¾¯Öµ
 141          extern u8  idata AlarmFlag2;
 142          
 143          struct KeyType{
 144            u8  Old       :1;     // ²ÉÑù¾ÉÖµ
 145            u8  New       :1;     // ²ÉÑùÐÂÖµ
 146            u8  Filt      :1;     // ²ÉÑùÂË²¨Öµ
 147            u8  Lv        :1;     // ¶Ë¿ÚµçÆ½
 148            u8  PreLv     :1;     // ¶Ë¿ÚµçÆ½¾ÉÖµ
 149            u8  Rise      :1;     // ÉÏÉýÑØ
 150            u8  Fall      :1;     // ÏÂ½µÑØ
 151          };
 152          
 153          struct KeyType KeySpeed;              // 
 154          struct KeyType KeyHeat;               // 
 155          struct KeyType KeyCool;               // 
 156          struct KeyType KeyOnOff;
 157          
 158          u8  KeyPro1msTmr;                     // 
 159          
 160          u8  PwrOnStage;                       // 
 161          u8  HeatDisableFlag;                  // 
 162          
 163          u16 idata HeatTemperADCVal;
 164          s16 idata HeatTemperCelsius;
 165          
 166          u8  idata KeyOnLockLv;                // ÈýÌ¬Ö¸Áî: 0£º¹Ø±Õ£»1£ºÊÜ¿Ø£»2£ºËø¶¨
 167          u8  idata KeyOnLockLvPre;             // ÈýÌ¬Ö¸ÁîÉÏÒ»´ÎÖµ
 168          u8  idata KeyOnLockSmpNew;            // ¶Ë¿Ú²ÉÑù
 169          u8  idata KeyOnLockSmpOld;
 170          u8  idata KeyOnLockKeepCnt;
 171          
 172          u8  idata SpeedShiftStep;           // ËÙ¶Èµ²Êµ¼ÊÖµ 1-4 ÆäÖÐ
 173          u8  idata SpeedCmdLv;               // ËÙ¶Èµ²ÃüÁîÖµ
 174          
 175          u8  idata HeatShiftStep;            // 
 176          u8  idata HeatCmdLv;                // 
 177          
C51 COMPILER V9.60.7.0   USERDRYER                                                         04/03/2024 13:19:55 PAGE 4   

 178          u8  idata CoolCmdLv;                // Àä·çÃüÁî
 179          u8  idata CoolShiftLv;              // 
 180          
 181          u8  idata ACCrossForThryrist;       // ¾§Õ¢¹Ü¿ØÖÆ²Î¿¼µÄ½»Á÷¹ýÁã±êÖ¾
 182          
 183          u8  idata RePowerRunTrig;           // ÖØÐÂÉÏµçºóµÄÆô¶¯´¥·¢
 184          
 185          u8  xdata HeatDutyH;                // ÉÏ·¢ÈÈË¿¼ÓÈÈÁ¿¸ø¶¨
 186          u8  xdata HeatDutyL;                // ÏÂ·¢ÈÈË¿¼ÓÈÈÁ¿¸ø¶¨
 187          u8  xdata HeatDutyMax;              // ¼ÓÈÈÁ¿¸÷µ²Î»¶ÔÓ¦µÄÏÞÖÆÖµ
 188          u8  xdata HeatDutyAlt;              // ¼ÓÈÈÁ¿µ÷½ÚÖµ
 189          u8  xdata HeatDutyAltTop;           // ¼ÓÈÈÁ¿µ÷½ÚÖµÉÏÏÞ
 190          
 191          u8  idata HeatDutyPeriod;           // ¼ÓÈÈ´¦ÀíÖÜÆÚ
 192          u8  idata HeatDutyOnCnt;            // ¼ÓÈÈÓÐÐ§Ê±¶Î
 193          u8  idata HeatDutyOnCnt2;           // ¼ÓÈÈÓÐÐ§Ê±¶Î
 194          
 195          u8  idata ThryristTrigKeepCnt;      // ¾§Õ¢¹Ü´¥·¢±£³ÖÊ±³¤ -ºÁÃë
 196          u8  idata ThryristTrigKeepCnt2;     // ¾§Õ¢¹Ü´¥·¢±£³ÖÊ±³¤ -ºÁÃë
 197          
 198          s8  idata WindTemperRef;            // ÈÈ·ç¸ø¶¨Öµ ÉãÊÏ¶È
 199          s16 idata HeatAdcValRef;            // ÈÈ·ç¸ø¶¨Öµ ADC×ª»»Öµ
 200          u16 idata LedAltX10ms;
 201          
 202          bit WindTemperHigh;                 // µçÈÈË¿¹ýÈÈ±êÖ¾
 203          bit LedHeat1;
 204          bit LedHeat2;
 205          bit LedHeat3;
 206          bit LedSpd1;
 207          bit LedSpd2;
 208          bit LedSpd3;
 209          
 210          u8  idata KeySpeedActX10ms;         // ÓÐÐ§×´Ì¬±£³Ö¼ÆÊ± ¡Á 10ms
 211          u16 idata ReverseCleanX10ms;        // ·´×ªÇå½àÊ±³¤
 212          
 213          bit ReverseCleanTrig;
 214          bit ReverseCleanCmd;
 215          bit Heat_wire_H = 1;
 216          bit Heat_wire_L = 1;
 217          
 218          u8  HeatRegulTmr;
 219          u8  WindTemperDelta;                // ÈÈ·ç¸ø¶¨ÓëÊµ²â²îÖµ
 220          u16 idata HeatLv4X10ms;             // ÈÈ·ç4µ²¼ÆÊ±
 221          
 222          u8  LedAlarmFlashCnt;               //´íÎóÖ¸Ê¾µÆÉÁË¸¼ÆÊý
 223          
 224          extern u8  HearterPMWDutyRise;
 225          extern u8  HearterPMWDutyDowm;
 226          
 227          u8  PowerVoltDownBase;
 228          u8  PowerVoltRiseBase;                   //Òò²»Í¬µµÎ»Õ¼¿Õ±È²»Í¬£¬ÏàÍ¬µçÑ¹²î¶ÔÓ¦µÄ¹¦ÂÊ²î²»Í¬
 229          
 230          //u8  idata HeatLowDuty=0;          // ¼ÓÈÈÁ¿¸ø¶¨
 231          //u8  idata HeatLowDutyMax=0;       // ¼ÓÈÈÁ¿×î´óÖµ
 232          //u8  idata KeySpeedLvStayCnt=0;    // µ±Ç°µçÆ½±£³Ö¼ÆÊý
 233          
 234          //u8  idata KeyHeatLvStayCnt=0;
 235          //u8  idata KeyHeatActX10ms=0;
 236          //u8  idata KeyCoolLvStayCnt=0;
 237          //u8  idata KeyCoolLvX10ms=0;
 238          //u8  idata KeyMt2LvStayCnt;
 239          //u8  idata KeyMt2LvX10ms;
C51 COMPILER V9.60.7.0   USERDRYER                                                         04/03/2024 13:19:55 PAGE 5   

 240          //u8  idata VZeroCrossLose;
 241          //u8  idata VZeroCrossReturn;
 242          //============================================================================//
 243          //----------------------------------------------------------------------------//
 244          // ËµÃ÷£ºËÙ¶Èµ²Î»°´¼ü¼ÆÊýÎª1-2-3-4-1-2...Ñ­»·£¬¶ÔÓ¦µ²Î»±ä»¯Ë³ÐòÎª1-2-3-2-1-2...Ñ­»·¼ÆÊý
 245          void CalSpeedStepToCmd(void)
 246          {
 247   1        // 1  2  3  4  1
 248   1        // 1  2  3  2  1
 249   1        
 250   1        if((SpeedShiftStep == 0)||(SpeedShiftStep >= (2*SPD_CMD_LV_MAX-1)))     // A-0  B-1  C-2  D-3  E-2  F-1 
             - G-2
 251   1          SpeedShiftStep = 1;
 252   1          
 253   1        if(SpeedShiftStep <= SPD_CMD_LV_MAX)
 254   1          SpeedCmdLv = SpeedShiftStep;
 255   1        else
 256   1          SpeedCmdLv = (2*SPD_CMD_LV_MAX) - SpeedShiftStep;
 257   1      }
 258          //----------------------------------------------------------------------------//
 259          // ËµÃ÷£ºÎÂ¶Èµ²Î»°´¼ü¼ÆÊýÎª0-1-2-3-4-5-0-1-2...Ñ­»·£¬¶ÔÓ¦µ²Î»±ä»¯Ë³ÐòÎª0-1-2-3-2-1-0-1-2...Ñ­»·¼ÆÊý
 260          void CalHeatStepToCmd(void)
 261          {
 262   1        // 0  1  2  3  4  5  6  7  0
 263   1        // 0  1  2  3  4  3  2  1  0
 264   1        
 265   1        // ÈÈ·çÓÐ0µ²ÐèÇó
 266   1        if(HeatShiftStep >= (2*HEAT_CMD_LV_MAX))      // A-0  B-1  C-2  D-3  E-4  F-3  G-2  H-1  I-0 
 267   1          HeatShiftStep = 0;
 268   1        
 269   1        // ÈÈ·çÎÞ0µ²ÐèÇó
 270   1      //  if((HeatShiftStep == 0)||(HeatShiftStep >= (2*HEAT_CMD_LV_MAX-1)))      // A-0  B-1  C-2  D-3  E-2  F-
             -1  G-2
 271   1      //    HeatShiftStep = 1;
 272   1        
 273   1        if(HeatShiftStep <= HEAT_CMD_LV_MAX)
 274   1          HeatCmdLv = HeatShiftStep;
 275   1        else
 276   1          HeatCmdLv = (2*HEAT_CMD_LV_MAX) - HeatShiftStep;
 277   1      }
 278          //----------------------------------------------------------------------------//
 279          // ËµÃ÷£º
 280          void CalCoolLvToCmd(void)
 281          {
 282   1        CoolCmdLv = CoolShiftLv;
 283   1      }
 284          //----------------------------------------------------------------------------//
 285          // ËµÃ÷£º¿ª¹Ø³õÊ¼»¯£¬×ªËÙµ²£¬ÎÂ¶Èµ²£¬Àä·çµ²£¬³õÊ¼Öµ¸ø¶¨
 286          void DryerKeysDefault(void)
 287          {
 288   1        SpeedShiftStep = START_SPD_CMD_LV;            // ×ªËÙ
 289   1        HeatShiftStep = START_HEAT_CMD_LV;            // ÎÂ¶È
 290   1        CoolShiftLv = START_COOL_CMD_LV;              // Àä·ç
 291   1      }
 292          //----------------------------------------------------------------------------//
 293          // ËµÃ÷£º¿ª¹Ø³õÊ¼»¯£¬×ªËÙµ²£¬ÎÂ¶Èµ²£¬Àä·çµ²£¬³õÊ¼Öµ¸ø¶¨
 294          //void KeysInitial(void)
 295          //{
 296          //  SpeedShiftStep = SpeedSavedStep = START_SPD_CMD_LV;   // ×ªËÙ
 297          //  HeatShiftStep = HeatSavedStep = START_HEAT_CMD_LV;    // ÎÂ¶È
 298          //  CoolShiftLv = CoolSavedLv = START_COOL_CMD_LV;        // Àä·ç
 299          
C51 COMPILER V9.60.7.0   USERDRYER                                                         04/03/2024 13:19:55 PAGE 6   

 300          //  CalSpeedStepToCmd();
 301          //  CalHeatStepToCmd();
 302          //  CalCoolLvToCmd();
 303          //}
 304          //----------------------------------------------------------------------------//
 305          // ËµÃ÷£º´µ·ç»ú°´¼ü¿ØÖÆ
 306          void DryerPer1ms(void)
 307          {
 308   1        
 309   1        KeyPro1msTmr = Loop1msCnt;   // Óë LoopProPer1ms() ¼ÆÊýÒ»ÖÂ
 310   1        
 311   1        // ·ÖÊ±´¦Àí
 312   1        if(KeyPro1msTmr == 2)
 313   1        {
 314   2          // ¶ÁÈ¡×Ü¿ª¹Ø×´Ì¬
 315   2      
 316   2          // ¨‹--------------------------------------¨‹ //
 317   2          // 1. ÎÞ¿ª¹Ø£¬ÉÏµçÔËÐÐ
 318   2          //
 319   2          KeyOnLockLv = 1;
 320   2          
 321   2         
 322   2          
 323   2          if(RePowerRunTrig == 1)
 324   2          {
 325   3            if(KeyOnLockLv > 0)
 326   3            {
 327   4              KeyOnOffCmd = 1;
 328   4              KeyOnOffTrig = 1;
 329   4            }
 330   3            
 331   3            RePowerRunTrig = 0;
 332   3          }
 333   2          
 334   2          if(KeyOnOffCmd == 0)
 335   2            KeyGoDuty = 0;
 336   2          
 337   2        }
 338   1        else if(KeyPro1msTmr == 3)
 339   1        {
 340   2          // ×Ü¿ª¹ØÓÐÐ§Ê±£¬¼ì²â¸÷°´Å¥
 341   2          {
 342   3            KeySpeed.New = KEY_SPEED;
 343   3            // Á¬ÐøÁ½´Î¼ì²âÎªÍ¬Ò»Öµ£¬È·ÈÏµ±Ç°Öµ
 344   3            if(KeySpeed.New == KeySpeed.Old)
 345   3              KeySpeed.Filt = KeySpeed.New;
 346   3            else
 347   3              KeySpeed.Old = KeySpeed.New;
 348   3            
 349   3            KeyHeat.New = KEY_HEAT;
 350   3            if(KeyHeat.New == KeyHeat.Old)
 351   3              KeyHeat.Filt = KeyHeat.New;
 352   3            else
 353   3              KeyHeat.Old = KeyHeat.New;
 354   3            
 355   3            KeyCool.New = KEY_COOL;
 356   3            if(KeyCool.New == KeyCool.Old)
 357   3              KeyCool.Filt = KeyCool.New;
 358   3            else
 359   3              KeyCool.Old = KeyCool.New;
 360   3            
 361   3            // »ñµÃµ÷ËÙ¶Ë¿Ú×´Ì¬
C51 COMPILER V9.60.7.0   USERDRYER                                                         04/03/2024 13:19:55 PAGE 7   

 362   3            KeySpeed.Rise = 0;                  // Çå³ýÉÏÌø±äÑØ
 363   3            KeySpeed.Fall = 0;                  // Çå³ýÏÂÌø±äÑØ
 364   3            KeySpeed.PreLv = KeySpeed.Lv;       // ±£´æÉÏ´ÎÖµ
 365   3            KeySpeed.Lv = KeySpeed.Filt;        // ¶ÁÈ¡±¾´ÎÖµ
 366   3             
 367   3            if(KeySpeed.Lv != KeySpeed.PreLv)   // Èç±¾´Î²»Í¬ÓÚÉÏ´Î£¬ÅÐ¶ÏÊÇºÎÖÖÌø±ä
 368   3            {
 369   4              if(KeySpeed.Lv == 1)              // ±¾´ÎÎª¸ß
 370   4                KeySpeed.Rise = 1;              // ÉÏÉýÑØÖÃÎ»
 371   4              else                              // ·ñÔòÎªÏÂ½µÑØ
 372   4              KeySpeed.Fall = 1;
 373   4            }
 374   3            
 375   3            // »ñµÃ¼ÓÈÈ¶Ë¿Ú×´Ì¬
 376   3            KeyHeat.Rise = 0;                 // Çå³ýÉÏÌø±äÑØ
 377   3            KeyHeat.Fall = 0;                 // Çå³ýÏÂÌø±äÑØ
 378   3            KeyHeat.PreLv = KeyHeat.Lv;       // ±£´æÉÏ´ÎÖµ
 379   3            KeyHeat.Lv = KeyHeat.Filt;
 380   3          
 381   3            if(KeyHeat.Lv != KeyHeat.PreLv)   // Èç±¾´Î²»Í¬ÓÚÉÏ´Î£¬ÅÐ¶ÏÊÇºÎÖÖÌø±ä
 382   3            {
 383   4              if(KeyHeat.Lv == 1)             // ±¾´ÎÎª¸ß
 384   4                KeyHeat.Rise = 1;             // ÉÏÉýÑØÖÃÎ»
 385   4              else                            // ·ñÔòÎªÏÂ½µÑØ
 386   4              KeyHeat.Fall = 1;
 387   4            }
 388   3            
 389   3            // »ñµÃÀä·ç¶Ë¿Ú×´Ì¬
 390   3            KeyCool.Rise = 0;                 // Çå³ýÉÏÌø±äÑØ
 391   3            KeyCool.Fall = 0;                 // Çå³ýÏÂÌø±äÑØ
 392   3            KeyCool.PreLv = KeyCool.Lv;       // ±£´æÉÏ´ÎÖµ
 393   3          
 394   3            KeyCool.Lv = KeyCool.Filt;
 395   3      
 396   3            if(KeyCool.Lv != KeyCool.PreLv)   // Èç±¾´Î²»Í¬ÓÚÉÏ´Î£¬ÅÐ¶ÏÊÇºÎÖÖÌø±ä
 397   3            {
 398   4              if(KeyCool.Lv == 1)             // ±¾´ÎÎª¸ß
 399   4                KeyCool.Rise = 1;             // ÉÏÉýÑØÖÃÎ»
 400   4              else                            // ·ñÔòÎªÏÂ½µÑØ
 401   4              KeyCool.Fall = 1;
 402   4            }
 403   3      
 404   3            // ÓÐÐ§×´Ì¬¼ÆÊ±
 405   3            if(KeySpeed.Lv == 0)
 406   3            {
 407   4              if(++KeySpeedActX10ms == 100)
 408   4                ReverseCleanTrig = 1;
 409   4              else if(KeySpeedActX10ms >= 101)
 410   4                KeySpeedActX10ms = 101;
 411   4            }
 412   3            else
 413   3              KeySpeedActX10ms = 0;
 414   3      
 415   3          }
 416   2        }
 417   1        else if(KeyPro1msTmr == 4)
 418   1        {
 419   2          if(KeyOnOffCmd == 1)       // ¿ªÆôÊ±¸÷°´¼üÓÐÐ§
 420   2          {
 421   3      
 422   3            // 
 423   3            if(KeyOnLockLv != 0)     // Ò»¼üÀä·ç²»¿¼ÂÇËø¶¨Ì¬
C51 COMPILER V9.60.7.0   USERDRYER                                                         04/03/2024 13:19:55 PAGE 8   

 424   3            {
 425   4              // ¨‹--------------------------------------¨‹ //
 426   4              // 1. Àä·ç°´¼ü´¦Àí,°´ÏÂÇÐ»»ÊÇ·ñÀä·ç
 427   4              if(KeyCool.Fall == 1)
 428   4              {
 429   5                KeyCool.Fall = 0;
 430   5                
 431   5                SpeedShiftStep--;  // xjc
 432   5                CalSpeedStepToCmd();
 433   5                
 434   5              }
 435   4              // ¡ø--------------------------------------¡ø //
 436   4              
 437   4              // ¨‹--------------------------------------¨‹ //
 438   4              // 2. Àä·ç°´¼ü´¦Àí,Ö»ÔÚ°´ÏÂÊ±Àä·ç
 439   4              if(KeyCool.Lv == 0)
 440   4                CoolCmdLv = CoolShiftLv = 1;
 441   4              else
 442   4                CoolCmdLv = CoolShiftLv = 0;
 443   4              // ¡ø--------------------------------------¡ø //
 444   4            }
 445   3            
 446   3            if(KeyOnLockLv == 1)    // Ëø¶¨Ê±µ÷ËÙµ÷ÎÂÎÞÐ§
 447   3            {
 448   4              // µ÷ËÙ°´¼ü´¦Àí
 449   4              if(KeySpeed.Fall == 1)
 450   4              {
 451   5                KeySpeed.Fall = 0;
 452   5                
 453   5                SpeedShiftStep++;
 454   5                CalSpeedStepToCmd();
 455   5              }
 456   4              
 457   4       
 458   4              
 459   4              // ¼ÓÈÈ°´¼ü´¦Àí
 460   4              if(KeyHeat.Fall == 1)
 461   4              {
 462   5                KeyHeat.Fall = 0;
 463   5      
 464   5                // ¼ÓÈÈ°´¼üÈ¡ÏûÀä·ç×´Ì¬
 465   5                //if(CoolCmdLv == 1)
 466   5                //  CoolCmdLv = 0;
 467   5              
 468   5              
 469   5                
 470   5      //          if(CoolCmdLv == 0)          // µ±Ç°·ÇÀä·ç×´Ì¬£¬°´Å¥ÓÐÐ§
 471   5      //          {
 472   5      //            HeatShiftStep++;
 473   5      //            CalHeatStepToCmd();
 474   5      //          }
 475   5              }
 476   4            }
 477   3          }
 478   2        }
 479   1        else if(KeyPro1msTmr == 5)
 480   1        {
 481   2          //xjc  1µµ·çËÙSPEED_LV1 Ò»´Î¼Óµµ·çËÙ¼Ó1000
 482   2      
 483   2            VspSpdCmd =   (SPEED_LV1 + (SpeedCmdLv - 1)*(SPEED_LV_ADD)) ;
 484   2            KeyGoDuty =   POWER_UXI_SMP_LV3;
 485   2      
C51 COMPILER V9.60.7.0   USERDRYER                                                         04/03/2024 13:19:55 PAGE 9   

 486   2      
 487   2      
 488   2          
 489   2          if(ReverseCleanCmd == 1)
 490   2            VspSpdCmd = _Q15(60000 / MOTOR_SPEED_BASE);
 491   2          
 492   2          // ÏÞ×ªËÙ»òÏÞ¹¦ÂÊ
 493   2          #if (CONTROL_TARGET==CONTROL_TARGET_POWER)
                  {
                    // ÏÞ×ªËÙ
                     if(mcFocCtrl.SpeedFlt > _Q15((GIVEN_MAX_RPM) / MOTOR_SPEED_BASE))
                       KeyGoDutyMax -= 10;
                     else if(mcFocCtrl.SpeedFlt < _Q15((GIVEN_MAX_RPM-1000) / MOTOR_SPEED_BASE))
                       KeyGoDutyMax += 10;
                    
                     if(KeyGoDutyMax > _Q12(1.0))
                       KeyGoDutyMax = _Q12(1.0);
                     else if(KeyGoDutyMax < _Q12(0.15))
                       KeyGoDutyMax = _Q12(0.15);
                     
                     if(KeyGoDuty > KeyGoDutyMax)
                      KeyGoDuty = KeyGoDutyMax;
                  }
                  #elif (CONTROL_TARGET==CONTROL_TARGET_SPEED)
 510   2          {
 511   3            // ÏÞ¹¦ÂÊ£¬ÏÞµçÁ÷
 512   3            // ¸ø¶¨ÖÍ»ØÇø£¬ÔÚ¿É¿Ø×ªËÙ·¶Î§ÄÚ×öÏÞÖÆ
 513   3            if(IBusFilt_mA > (u16)(I_BUS_MAX*1000))               //365)//810)//       
 514   3              VspSpdCmdMax-=10;
 515   3            else if(IBusFilt_mA < (u16)((I_BUS_MAX-0.010)*1000))  //355)//800)//  
 516   3              VspSpdCmdMax+=10;
 517   3            
 518   3            if(VspSpdCmdMax > GIVEN_MAX_SPD)
 519   3              VspSpdCmdMax = GIVEN_MAX_SPD;
 520   3            else if(VspSpdCmdMax < GIVEN_MIN_SPD)
 521   3              VspSpdCmdMax = GIVEN_MIN_SPD;
 522   3      
 523   3            if(VspSpdCmd > VspSpdCmdMax)
 524   3              VspSpdCmd = VspSpdCmdMax;
 525   3              
 526   3          }
 527   2          #endif
 528   2          
 529   2          if(KeyOnOffCmd == 0)
 530   2            KeyGoDuty = 0;
 531   2          
 532   2        }
 533   1        else if(KeyPro1msTmr == 6)
 534   1        {
 535   2          // ÊÇ·ñ¼ì²âµçÈÈË¿ÎÂ¶È¡£
 536   2      //    #if (CHECK_HEATER_TEMPER == 1)
 537   2      //    WindTemperNow = HeatTemperCelsius;    // ÈçÊÇ£¬¼ì²â¡£
 538   2      //    HeatAdcValNow = HeatTemperADCVal;
 539   2      //    #else
 540   2      //    WindTemperNow = 25;                   // Èç·ñ£¬¸ø¶¨µ±Ç°ÎÂ¶ÈÎª³£ÎÂÖµ¡£
 541   2      //    HeatAdcValNow = HEAT_CELSIUS_ADC(100.0);
 542   2      //    #endif
 543   2              
 544   2      
 545   2      //    if(mcState == mcRun)                // ½öÔÚµç»úÔËÐÐÊ±¿ªµçÈÈË¿
 546   2      //      HeatDisableFlag = 0;
 547   2      //    else
C51 COMPILER V9.60.7.0   USERDRYER                                                         04/03/2024 13:19:55 PAGE 10  

 548   2      //    
 549   2          
 550   2        
 551   2          // È·¶¨¸÷µ²Î»ÈÈ¶È×î¸ßµ÷½ÚÁ¿
 552   2      
 553   2          if((CoolCmdLv == 1)||(KeyOnOffCmd == 0)||(mcState != mcRun))
 554   2          {
 555   3            HeatDisableFlag = 1;
 556   3            HeatDutyMax = 0;
 557   3          }
 558   2          else
 559   2          {
 560   3            HeatDisableFlag = 0;
 561   3            // ²»Í¬µ²Î»¶ÔÓ¦µÄµçÈÈÕ¼¿Õ±ÈºÍÎÂ¶ÈÖµ
 562   3            if(HeatCmdLv == 4)
 563   3            {
 564   4              if(SpeedCmdLv == 1)
 565   4              {
 566   5                PowerVoltRiseBase = 25;
 567   5                PowerVoltDownBase = 120;
 568   5                HeatDutyMax = HEAT_DUTY_LV1 + 1; 
 569   5              }
 570   4              else if(SpeedCmdLv == 2)
 571   4              {
 572   5                PowerVoltRiseBase = 22;
 573   5                PowerVoltDownBase = 70;
 574   5                HeatDutyMax = HEAT_DUTY_LV2;
 575   5              }
 576   4              else
 577   4              {
 578   5                PowerVoltRiseBase = 25;
 579   5                PowerVoltDownBase = 55;
 580   5                HeatDutyMax = HEAT_DUTY_LV3;
 581   5              }
 582   4              WindTemperRef = HEAT_TEMPER_LV4;
 583   4              HeatAdcValRef = HEAT_ADC_VAL_LV4;
 584   4              
 585   4            }
 586   3            else if(HeatCmdLv == 3)
 587   3            {
 588   4                WindTemperRef = HEAT_TEMPER_LV3;
 589   4                HeatAdcValRef = HEAT_ADC_VAL_LV3;
 590   4              if(SpeedCmdLv == 1)
 591   4              {
 592   5                PowerVoltRiseBase = 22;
 593   5                PowerVoltDownBase = 60;
 594   5                WindTemperRef = HEAT_TEMPER_LV3 - 2; 
 595   5                HeatDutyMax = HEAT_DUTY_LV3 - 2;
 596   5              }
 597   4              else if(SpeedCmdLv == 2)
 598   4              {
 599   5                HeatDutyMax = HEAT_DUTY_LV3 - 1;
 600   5                PowerVoltRiseBase = 25;
 601   5                PowerVoltDownBase = 55;
 602   5              }
 603   4              else
 604   4              {
 605   5                HeatDutyMax = HEAT_DUTY_LV3;
 606   5                PowerVoltRiseBase = 25;
 607   5                PowerVoltDownBase = 55;
 608   5              }   
 609   4            }
C51 COMPILER V9.60.7.0   USERDRYER                                                         04/03/2024 13:19:55 PAGE 11  

 610   3            else if(HeatCmdLv == 2)
 611   3            {
 612   4             if(SpeedCmdLv == 1)
 613   4             {
 614   5               PowerVoltRiseBase = 35;
 615   5               PowerVoltDownBase = 100;
 616   5               WindTemperRef = HEAT_TEMPER_LV2 - 2; 
 617   5               HeatDutyMax = HEAT_DUTY_LV2 - 3;
 618   5             }
 619   4             else if(SpeedCmdLv == 2)
 620   4             {
 621   5              PowerVoltRiseBase = 25;
 622   5              PowerVoltDownBase = 80;
 623   5              HeatDutyMax = HEAT_DUTY_LV2 - 1;
 624   5              WindTemperRef = HEAT_TEMPER_LV2;
 625   5              HeatAdcValRef = HEAT_ADC_VAL_LV2;
 626   5             }
 627   4             else
 628   4             {
 629   5              PowerVoltRiseBase = 22;
 630   5              PowerVoltDownBase = 70;
 631   5              HeatDutyMax = HEAT_DUTY_LV2;
 632   5              WindTemperRef = HEAT_TEMPER_LV2;
 633   5              HeatAdcValRef = HEAT_ADC_VAL_LV2;
 634   5             }
 635   4            }
 636   3            else if(HeatCmdLv == 1)
 637   3            {
 638   4              if(SpeedCmdLv == 1)
 639   4             {
 640   5              PowerVoltRiseBase = 45;
 641   5              PowerVoltDownBase = 120;
 642   5              HeatDutyMax = HEAT_DUTY_LV1 - 2;
 643   5              WindTemperRef = HEAT_TEMPER_LV1;
 644   5              HeatAdcValRef = HEAT_ADC_VAL_LV1;
 645   5             }
 646   4              else if(SpeedCmdLv == 2)
 647   4             {
 648   5               PowerVoltRiseBase = 45;
 649   5               PowerVoltDownBase = 120;
 650   5               HeatDutyMax = HEAT_DUTY_LV1 - 1;
 651   5             }
 652   4             else
 653   4             {
 654   5              PowerVoltRiseBase = 40;
 655   5              PowerVoltDownBase = 120;
 656   5              HeatDutyMax = HEAT_DUTY_LV1;
 657   5             }
 658   4            }
 659   3            else
 660   3            {
 661   4              HeatDutyMax = 0;
 662   4              WindTemperRef = 10;
 663   4              HeatAdcValRef = 4096;
 664   4            }
 665   3          }
 666   2          
 667   2          // Á½ÖÖµçÈÈË¿¿ØÖÆ·½Ê½£¬Ò»²»¿ØÎÂ£¬¶þ¿ØÎÂ
 668   2          // ¨‹--------------------------------------¨‹ //
 669   2          // 1.¸ù¾Ýµ²Î»È·¶¨Êä³öÁ¿-Õ¼¿Õ±È£¬²»µ÷ÎÂ
 670   2      //    HeatDuty = HeatDutyMax;
 671   2          // ¡ø--------------------------------------¡ø //
C51 COMPILER V9.60.7.0   USERDRYER                                                         04/03/2024 13:19:55 PAGE 12  

 672   2          
 673   2          // ¨‹--------------------------------------¨‹ //
 674   2          // 2.¸ù¾Ýµ²Î»¸ø¶¨µÄÎÂ¶È£¬µ÷½ÚÊä³öÁ¿-Õ¼¿Õ±È£¬µ÷ÎÂ
 675   2          #if (CHECK_HEATER_TEMPER == 1)    // ÈçÐè¼ì²âµçÈÈË¿ÎÂ¶È
 676   2          // a.b. ¶þÑ¡Ò»
 677   2          // a.¸ù¾Ý²âµÃÉãÊÏ¶È
 678   2          if(mcState == mcRun)
 679   2          {
 680   3          if(HeatTemperCelsius > HEAT_TEMPER_LV1)             //µ±Ç°ÎÂ¶È¸ßÓÚ¸ø¶¨Öµ£¬ÉèÖÃ¹ýÎÂ±êÖ¾
 681   3          {
 682   4            WindTemperHigh = 1;
 683   4            WindTemperDelta = 0;
 684   4      //      SaveCnt = 0;
 685   4          }
 686   3          }
 687   2      //    else if(HeatTemperCelsius <= (WindTemperRef-0))    //Îª·ÀÖ¹ÁÙ½çµãÊ¶±ð¶¶¶¯£¬µ±Ç°ÎÂ¶ÈµÍÓÚ¸ø¶¨Öµ¼õÈ¥ÖÍ»
             -ØÇø¼ä£¬
 688   2      //    {
 689   2      //      WindTemperHigh = 0;
 690   2      //      WindTemperDelta = WindTemperRef - HeatTemperCelsius;
 691   2      //    }
 692   2          
 693   2          // b.¸ù¾ÝADC²ÉÑùÖµ
 694   2      //    if(HeatTemperADCVal < HeatAdcValRef)             //µ±Ç°ÎÂ¶È¸ßÓÚ¸ø¶¨Öµ£¬ÉèÖÃ¹ýÎÂ±êÖ¾
 695   2      //      WindTemperHigh = 1;
 696   2      //    else if(HeatTemperADCVal > (HeatAdcValRef+10))  //Îª·ÀÖ¹ÁÙ½çµãÊ¶±ð¶¶¶¯£¬µ±Ç°ÎÂ¶ÈµÍÓÚ¸ø¶¨Öµ¼õÈ¥ÖÍ»ØÇø
             -¼ä£¬
 697   2      //      WindTemperHigh = 0;
 698   2          
 699   2          // a.b.½áÊø
 700   2          if(HeatTemperADCVal > 4050)                       // ÏßÂ·¹ÊÕÏÊ±£¬²ÉÑùÖµ½«½Ó½üQ12(1),°²È«ÖµÒÔÏÂ¿ªÆôµçÈÈ
             -Ë¿
 701   2            HeatDutyMax = 0;
 702   2          
 703   2          #else                                             // Èç·ñ£¬²»²âÎÂ¶È£¬±£³Ö¼ÓÈÈ×´Ì¬
                  WindTemperHigh = 0;
                  
                  #endif
 707   2          
 708   2          if(CoolCmdLv != 1)
 709   2          {
 710   3      //      if(++HeatRegulTmr >= 6)
 711   3      //      {
 712   3      //        HeatRegulTmr = 0;
 713   3      //        
 714   3      //        if(WindTemperHigh == 1)
 715   3      //        {
 716   3      //          if(HeatDutyAlt > 0)
 717   3      //            HeatDutyAlt--;
 718   3      //          
 719   3      //          HeatDutyAltTop = 0;
 720   3      //        }
 721   3      //        else
 722   3      //        {
 723   3      //          HeatDutyAlt++;
 724   3      //          if(WindTemperDelta < 20)
 725   3      //            HeatDutyAltTop = WindTemperDelta;
 726   3      //          else
 727   3      //            HeatDutyAltTop = 19;
 728   3      //        }
 729   3      //      }
 730   3            HeatDutyAlt = HeatDutyMax;
C51 COMPILER V9.60.7.0   USERDRYER                                                         04/03/2024 13:19:55 PAGE 13  

 731   3          }
 732   2          else
 733   2          {
 734   3            HeatRegulTmr = 0;
 735   3          }
 736   2          // ¨Œ---------------------------------------- //
 737   2          // 4µ²ÈÈÎªÀäÈÈÑ­»··ç
 738   2          #if (HEAT_CMD_LV_MAX == 4)
 739   2          if(HeatCmdLv == 4 && CoolCmdLv == 0)
 740   2          {
 741   3            if(++HeatLv4X10ms > 1142)
 742   3              HeatLv4X10ms = 0;
 743   3            else if(HeatLv4X10ms > 428)
 744   3              HeatDutyMax = 0;
 745   3          }
 746   2          else
 747   2            HeatLv4X10ms = 0;
 748   2          #endif
 749   2          // ----------------------------------------¡÷ //
 750   2              
 751   2      //    if(HeatDutyAlt > HeatDutyAltTop)
 752   2      //      HeatDutyAlt = HeatDutyAltTop;
 753   2          
 754   2          if(HeatDutyAlt > HeatDutyMax)
 755   2            HeatDutyAlt = HeatDutyMax;
 756   2          
 757   2          if(HeatDutyMax != 0)
 758   2          {
 759   3            if(HeatDutyAlt > HearterPMWDutyDowm)
 760   3            {
 761   4              HeatDutyAlt = HeatDutyAlt + HearterPMWDutyRise - HearterPMWDutyDowm;
 762   4            }
 763   3            else
 764   3            {
 765   4              HeatDutyAlt = 1;
 766   4            }
 767   3          }
 768   2      
 769   2          if(HeatDutyAlt > 20)
 770   2            HeatDutyAlt = 20;
 771   2          
 772   2          HeatDutyH = HeatDutyAlt/2;
 773   2          HeatDutyL = HeatDutyH + HeatDutyAlt%2;
 774   2      
 775   2          // ¡ø--------------------------------------¡ø //
 776   2          
 777   2        }
 778   1        else if(KeyPro1msTmr == 7)
 779   1        {
 780   2          if(mcState == mcRun && KeyOnOffCmd == 1){
 781   3              
 782   3            LED_SPEED_bit_1 = !(bit)((SpeedCmdLv & 0x01)>>0);
 783   3            LED_SPEED_bit_2 = !(bit)((SpeedCmdLv & 0x02)>>1);
 784   3            LED_SPEED_bit_3 = !(bit)((SpeedCmdLv & 0x04)>>2);
 785   3            LED_SPEED_bit_4 = !(bit)((SpeedCmdLv & 0x08)>>3);
 786   3            LED_SPEED_bit_5 = !(bit)((SpeedCmdLv & 0x10)>>4);
 787   3            LED_SPEED_bit_6 = !(bit)((SpeedCmdLv & 0x20)>>5);       
 788   3            
 789   3            }
 790   2        }
 791   1      
 792   1        #if (THRYRST_ENABLE == 1)
C51 COMPILER V9.60.7.0   USERDRYER                                                         04/03/2024 13:19:55 PAGE 14  

 793   1        // Thryster ¿ØÖÆ--------------------------------//
 794   1        // ÔÚÕý³£½»Á÷ÓÃµçÇé¿öÏÂÃ¿10ms¿É²âµÃÒ»´Î¹ýÁã
 795   1        // ½»Á÷µçÔ´¹ýÁã±êÖ¾ÔÚÖÐ¶Ï´¦ÀíÖÐÉèÖÃ£¬´Ë´¦Ã¿ºÁÃë¼ì²â±êÖ¾Î»
 796   1        if(ACCrossForThryrist == 1)
 797   1        {
 798   2          ACCrossForThryrist = 0;
 799   2          
 800   2          // Êä³öÁ¿Õ¼¿Õ±È´¦Àí£¬10´Î¹ýÁãÎªÒ»¸öÖÜÆÚ
 801   2          if(HeatDutyOnCnt < HeatDutyH)
 802   2            ThryristTrigKeepCnt = 3;      // ÉèÖÃ¾§Õ¢¹Ü´¥·¢±£³ÖÊ±³¤ -ºÁÃë
 803   2          else
 804   2            ThryristTrigKeepCnt = 0;
 805   2          
 806   2          if(++HeatDutyOnCnt >= 10)
 807   2            HeatDutyOnCnt = 0;
 808   2          
 809   2          if(HeatDutyOnCnt2 >= (10 - HeatDutyL))
 810   2            ThryristTrigKeepCnt2 = 3;      // ÉèÖÃ¾§Õ¢¹Ü´¥·¢±£³ÖÊ±³¤ -ºÁÃë
 811   2           else
 812   2            ThryristTrigKeepCnt2 = 0;
 813   2          
 814   2          if(++HeatDutyOnCnt2 >= 10)
 815   2            HeatDutyOnCnt2 = 0;   
 816   2          
 817   2      //    if(WindTemperHigh == 0)             //µ±Ç°ÎÂ¶È¸ßÓÚ¸ø¶¨Öµ£¬ÉèÖÃ¹ýÎÂ±êÖ¾
 818   2      //    {
 819   2      //      SaveCnt = 0;
 820   2      //    }
 821   2      //    else
 822   2      //    {
 823   2      //      SaveLine[SaveCnt] = HeatTemperCelsius;
 824   2      //      if(++SaveCnt>=24)
 825   2      //        SaveCnt = 0;
 826   2      //    }
 827   2        }
 828   1          
 829   1        
 830   1        // ¾§Õ¢¹Üµ¼Í¨ÐÅºÅ±£³ÖÊ±³¤NºÁÃë ¶þÑ¡Ò»
 831   1        // ¨‹--------------------------------------¨‹ //
 832   1        // 1. Í¬Ê±¿ØÖÆÁ½¸ö¹Ü×Ó
 833   1      //  if(ThryristTrigKeepCnt > 0)
 834   1      //  {
 835   1      //    ThryristTrigKeepCnt --;
 836   1      
 837   1      //    if(RunningX1ms > 1000)
 838   1      //    {
 839   1      //      HEAT_WIRE_H_ON;
 840   1      //      HEAT_WIRE_L_ON;//HEAT_WIRE_L_OFF;//
 841   1      //    }
 842   1      //    else
 843   1      //    {
 844   1      //      HEAT_WIRE_H_OFF;
 845   1      //      HEAT_WIRE_L_OFF;
 846   1      //    }
 847   1      //  }
 848   1      //  else
 849   1      //  {
 850   1      //    HEAT_WIRE_H_OFF;
 851   1      //    HEAT_WIRE_L_OFF;
 852   1      //  }
 853   1        // ¡ô--------------------------------------¡ô //
 854   1        // 2. ·Ö±ð¿ØÖÆÁ½¸ö¹Ü×Ó
C51 COMPILER V9.60.7.0   USERDRYER                                                         04/03/2024 13:19:55 PAGE 15  

 855   1        if(ThryristTrigKeepCnt > 0)
 856   1        {
 857   2      //    ThryristTrigKeepCnt --;
 858   2            
 859   2          if(RunningX1ms > 1000)
 860   2            Heat_wire_H = HEAT_WIRE_H_ON;
 861   2          else
 862   2            Heat_wire_H = HEAT_WIRE_H_OFF;
 863   2        }
 864   1        else
 865   1          Heat_wire_H = HEAT_WIRE_H_OFF;
 866   1        
 867   1      
 868   1        if(ThryristTrigKeepCnt2 > 0)
 869   1        {
 870   2      //    ThryristTrigKeepCnt2 --;
 871   2            
 872   2          if(RunningX1ms > 1000)
 873   2            Heat_wire_L = HEAT_WIRE_L_ON;
 874   2          else
 875   2            Heat_wire_L = HEAT_WIRE_L_OFF;
 876   2        }
 877   1        else
 878   1          Heat_wire_L = HEAT_WIRE_L_OFF;
 879   1        // ¡ø--------------------------------------¡ø //
 880   1        #endif
 881   1        
 882   1      //  // µ÷ÊÔÖÐ£¬¹Ø±Õ¾§Õ¢¹Ü
 883   1      //  HEAT_WIRE_H_OFF;
 884   1      //  HEAT_WIRE_L_OFF;
 885   1      
 886   1        if(PwrOnStage == 0)
 887   1        {
 888   2          KeyGoDuty = _Q12(0);
 889   2          
 890   2          if((PwrOnX1ms > 50)||(QuickStartFlag==1))
 891   2          {
 892   3            PwrOnStage = 2;
 893   3            KeyOnOffCmd = 1;
 894   3            //KeyOnLockLv = 1;
 895   3            KeyOnOffTrig = 0;
 896   3          }
 897   2        }
 898   1      }
 899            


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1817    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     17    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =     32    ----
   BIT SIZE         =     11    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
